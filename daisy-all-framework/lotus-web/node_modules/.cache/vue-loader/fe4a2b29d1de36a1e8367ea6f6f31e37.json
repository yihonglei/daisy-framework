{"remainingRequest":"/Users/hongqi/Documents/jpeony/daisy-framework/daisy-all-framework/mhjy_manager/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/hongqi/Documents/jpeony/daisy-framework/daisy-all-framework/mhjy_manager/src/views/permission/role.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/hongqi/Documents/jpeony/daisy-framework/daisy-all-framework/mhjy_manager/src/views/permission/role.vue","mtime":1660530974000},{"path":"/Users/hongqi/Documents/jpeony/daisy-framework/daisy-all-framework/mhjy_manager/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hongqi/Documents/jpeony/daisy-framework/daisy-all-framework/mhjy_manager/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/hongqi/Documents/jpeony/daisy-framework/daisy-all-framework/mhjy_manager/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hongqi/Documents/jpeony/daisy-framework/daisy-all-framework/mhjy_manager/node_modules/vue-loader/lib/index.js","mtime":1655715098000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnCmltcG9ydCB7IGRlZXBDbG9uZSB9IGZyb20gJ0AvdXRpbHMnCmltcG9ydCB7IGdldFRva2VuLCBzZXRUb2tlbiwgcmVtb3ZlVG9rZW4gfSBmcm9tICdAL3V0aWxzL2F1dGgnCmltcG9ydCBjaGVja1Blcm1pc3Npb24gZnJvbSAnQC91dGlscy9wZXJtaXNzaW9uJyAvLyDmnYPpmZDliKTmlq3lh73mlbAKCmNvbnN0IGRlZmF1bHRSb2xlID0gewogIGlkOiAwLAogIG5hbWU6ICcnLAogIGludHJvOiAnJywKICByb3V0ZXM6IFtdCn0KCmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgcm9sZTogT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdFJvbGUpLAogICAgICByb3V0ZXM6IFtdLAogICAgICByb2xlc0xpc3Q6IFtdLAogICAgICBkaWFsb2dWaXNpYmxlOiBmYWxzZSwKICAgICAgZGlhbG9nVHlwZTogJ25ldycsCiAgICAgIGNoZWNrU3RyaWN0bHk6IGZhbHNlLAogICAgICBkZWZhdWx0UHJvcHM6IHsKICAgICAgICBjaGlsZHJlbjogJ2NoaWxkcmVuJywKICAgICAgICBsYWJlbDogJ3RpdGxlJywKICAgICAgICB0aXRsZTogJ3RpdGxlJywKICAgICAgICBpZDogMAogICAgICB9CiAgICB9CiAgfSwKICBjb21wdXRlZDogewogICAgcm91dGVzRGF0YSgpIHsKICAgICAgcmV0dXJuIHRoaXMucm91dGVzCiAgICB9CiAgfSwKICBjcmVhdGVkKCkgewogICAgLy8gTW9jazogZ2V0IGFsbCByb3V0ZXMgYW5kIHJvbGVzIGxpc3QgZnJvbSBzZXJ2ZXIKICAgIHRoaXMuZ2V0Um91dGVzKCkKICAgIHRoaXMuZ2V0Um9sZXMoKQogIH0sCiAgbWV0aG9kczogewogICAgY2hlY2tQZXJtaXNzaW9uLAogICAgYXN5bmMgZ2V0Um91dGVzKCkgewogICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmFwaS5yb2xlKCkuZ2V0Um91dGVzKCkKICAgICAgdGhpcy5zZXJ2aWNlUm91dGVzID0gcmVzLmRhdGEKCiAgICAgIHRoaXMucm91dGVzID0gdGhpcy5nZW5lcmF0ZVJvdXRlcyhyZXMuZGF0YSkKICAgIH0sCiAgICBhc3luYyBnZXRSb2xlcygpIHsKICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5hcGkucm9sZSgpLmdldFJvbGVzKHt0b2tlbjpnZXRUb2tlbigpfSkKICAgICAgdGhpcy5yb2xlc0xpc3QgPSByZXMuZGF0YQogICAgfSwKCiAgICAvLyBSZXNoYXBlIHRoZSByb3V0ZXMgc3RydWN0dXJlIHNvIHRoYXQgaXQgbG9va3MgdGhlIHNhbWUgYXMgdGhlIHNpZGViYXIKICAgIGdlbmVyYXRlUm91dGVzKHJvdXRlcywgYmFzZVBhdGggPSAnLycpIHsKICAgICAgY29uc3QgcmVzID0gW10KCiAgICAgIGZvciAobGV0IHJvdXRlIG9mIHJvdXRlcykgewogICAgICAgIC8vIHNraXAgc29tZSByb3V0ZQogICAgICAgIGlmIChyb3V0ZS5oaWRkZW4pIHsgY29udGludWUgfQoKICAgICAgICBjb25zdCBvbmx5T25lU2hvd2luZ0NoaWxkID0gdGhpcy5vbmx5T25lU2hvd2luZ0NoaWxkKHJvdXRlLmNoaWxkcmVuLCByb3V0ZSkKCiAgICAgICAgaWYgKHJvdXRlLmNoaWxkcmVuICYmIG9ubHlPbmVTaG93aW5nQ2hpbGQgJiYgIXJvdXRlLmFsd2F5c1Nob3cpIHsKICAgICAgICAgIHJvdXRlID0gb25seU9uZVNob3dpbmdDaGlsZAogICAgICAgIH0KCiAgICAgICAgY29uc3QgZGF0YSA9IHsKICAgICAgICAgIHBhdGg6IHBhdGgucmVzb2x2ZShiYXNlUGF0aCwgcm91dGUucGF0aCksCiAgICAgICAgICB0aXRsZTogcm91dGUudGl0bGUsCiAgICAgICAgICBsYWJlbDogcm91dGUudGl0bGUsCiAgICAgICAgICBpZDogcm91dGUuaWQKICAgICAgICB9CgogICAgICAgIC8vIHJlY3Vyc2l2ZSBjaGlsZCByb3V0ZXMKICAgICAgICBpZiAocm91dGUuY2hpbGRyZW4pIHsKICAgICAgICAgIGRhdGEuY2hpbGRyZW4gPSB0aGlzLmdlbmVyYXRlUm91dGVzKHJvdXRlLmNoaWxkcmVuLCBkYXRhLnBhdGgpCiAgICAgICAgfQogICAgICAgIHJlcy5wdXNoKGRhdGEpCiAgICAgIH0KICAgICAgcmV0dXJuIHJlcwogICAgfSwKICAgIGdlbmVyYXRlQXJyKHJvdXRlcykgewogICAgICBsZXQgZGF0YSA9IFtdCiAgICAgIHJvdXRlcy5mb3JFYWNoKHJvdXRlID0+IHsKICAgICAgICBkYXRhLnB1c2gocm91dGUpCiAgICAgICAgaWYgKHJvdXRlLmNoaWxkcmVuKSB7CiAgICAgICAgICBjb25zdCB0ZW1wID0gdGhpcy5nZW5lcmF0ZUFycihyb3V0ZS5jaGlsZHJlbikKICAgICAgICAgIGlmICh0ZW1wLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgZGF0YSA9IFsuLi5kYXRhLCAuLi50ZW1wXQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSkKICAgICAgcmV0dXJuIGRhdGEKICAgIH0sCiAgICBoYW5kbGVBZGRSb2xlKCkgewogICAgICB0aGlzLnJvbGUgPSBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0Um9sZSkKICAgICAgaWYgKHRoaXMuJHJlZnMudHJlZSkgewogICAgICAgIHRoaXMuJHJlZnMudHJlZS5zZXRDaGVja2VkTm9kZXMoW10pCiAgICAgIH0KICAgICAgdGhpcy5kaWFsb2dUeXBlID0gJ25ldycKICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gdHJ1ZQogICAgfSwKICAgIGhhbmRsZUVkaXQoc2NvcGUpIHsKICAgICAgdGhpcy5kaWFsb2dUeXBlID0gJ2VkaXQnCiAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IHRydWUKICAgICAgdGhpcy5jaGVja1N0cmljdGx5ID0gdHJ1ZQogICAgICB0aGlzLnJvbGUgPSBkZWVwQ2xvbmUoc2NvcGUucm93KQogICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgY29uc3Qgcm91dGVzID0gdGhpcy5nZW5lcmF0ZVJvdXRlcyh0aGlzLnJvbGUucm91dGVzKQogICAgICAgIHRoaXMuJHJlZnMudHJlZS5zZXRDaGVja2VkTm9kZXModGhpcy5nZW5lcmF0ZUFycihyb3V0ZXMpKQogICAgICAgIC8vIHNldCBjaGVja2VkIHN0YXRlIG9mIGEgbm9kZSBub3QgYWZmZWN0cyBpdHMgZmF0aGVyIGFuZCBjaGlsZCBub2RlcwogICAgICAgIHRoaXMuY2hlY2tTdHJpY3RseSA9IGZhbHNlCiAgICAgIH0pCiAgICB9LAogICAgaGFuZGxlRGVsZXRlKHsgJGluZGV4LCByb3cgfSkgewogICAgICBpZiAocm93LmlkID09IDEpIHsKICAgICAgICB0aGlzLiRtZXNzYWdlKHsKICAgICAgICAgIHR5cGU6ICd3YXJuaW5nJywKICAgICAgICAgIG1lc3NhZ2U6ICfotoXnuqfnrqHnkIblkZjml6Dms5XliKDpmaQhJwogICAgICAgIH0pCiAgICAgICAgcmV0dXJuCiAgICAgIH0KICAgICAgdGhpcy4kY29uZmlybSgn56Gu5a6a5Yig6Zmk5q2k6KeS6ImyPycsICfmj5DnpLonLCB7CiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICfnoa7orqQnLAogICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6ICflj5bmtognLAogICAgICAgIHR5cGU6ICd3YXJuaW5nJwogICAgICB9KQogICAgICAgIC50aGVuKGFzeW5jKCkgPT4gewogICAgICAgICAgYXdhaXQgdGhpcy5hcGkucm9sZSgpLmRlbGV0ZVJvbGUoeydpZCc6cm93LmlkfSkKICAgICAgICAgIHRoaXMucm9sZXNMaXN0LnNwbGljZSgkaW5kZXgsIDEpCiAgICAgICAgICB0aGlzLiRtZXNzYWdlKHsKICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLAogICAgICAgICAgICBtZXNzYWdlOiAn5Yig6Zmk5oiQ5YqfIScKICAgICAgICAgIH0pCiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goZXJyID0+IHsgY29uc29sZS5lcnJvcihlcnIpIH0pCiAgICB9LAogICAgYXN5bmMgY29uZmlybVJvbGUoKSB7CiAgICAgIGNvbnN0IGlzRWRpdCA9IHRoaXMuZGlhbG9nVHlwZSA9PT0gJ2VkaXQnCgogICAgICBjb25zdCBjaGVja2VkS2V5cyA9IHRoaXMuJHJlZnMudHJlZS5nZXRDaGVja2VkS2V5cygpCgogICAgICBsZXQgcm91dGVzID0gdGhpcy5nZW5lcmF0ZVRyZWUoZGVlcENsb25lKHRoaXMuc2VydmljZVJvdXRlcyksIC0xLCBjaGVja2VkS2V5cykKCiAgICAgIGxldCByb3V0ZUlkcyA9IFtdCiAgICAgIHRoaXMuZ2VuZXJhdGVUcmVlUm91dGVJZHMocm91dGVzLCByb3V0ZUlkcyk7CiAgICAgIHRoaXMucm9sZS5yb3V0ZUlkcyA9IHJvdXRlSWRzLmpvaW4oJywnKQoKICAgICAgaWYgKGlzRWRpdCkgewogICAgICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgdGhpcy5hcGkucm9sZSgpLnVwZGF0ZVJvbGUodGhpcy5yb2xlKQogICAgICAgIHRoaXMucm9sZS5yb3V0ZXMgPSBkYXRhLnJvdXRlcwogICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLnJvbGVzTGlzdC5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgIGlmICh0aGlzLnJvbGVzTGlzdFtpbmRleF0uaWQgPT09IHRoaXMucm9sZS5pZCkgewogICAgICAgICAgICB0aGlzLnJvbGVzTGlzdC5zcGxpY2UoaW5kZXgsIDEsIE9iamVjdC5hc3NpZ24oe30sIHRoaXMucm9sZSkpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgdGhpcy5hcGkucm9sZSgpLmFkZFJvbGUodGhpcy5yb2xlKQogICAgICAgIHRoaXMucm9sZS5pZCA9IGRhdGEuaWQKICAgICAgICB0aGlzLnJvbGUucm91dGVzID0gZGF0YS5yb3V0ZXMKICAgICAgICB0aGlzLnJvbGVzTGlzdC5wdXNoKHRoaXMucm9sZSkKICAgICAgfQoKICAgICAgY29uc3QgeyBpZCwgbmFtZSwgaW50cm8gfSA9IHRoaXMucm9sZQogICAgICB0aGlzLmRpYWxvZ1Zpc2libGUgPSBmYWxzZQogICAgICB0aGlzLiRub3RpZnkoewogICAgICAgIHRpdGxlOiAnU3VjY2VzcycsCiAgICAgICAgZGFuZ2Vyb3VzbHlVc2VIVE1MU3RyaW5nOiB0cnVlLAogICAgICAgIG1lc3NhZ2U6IGAKICAgICAgICAgICAgPGRpdj7op5LoibJJRDogJHtpZH08L2Rpdj4KICAgICAgICAgICAgPGRpdj7op5LoibLlkI3np7A6ICR7bmFtZX08L2Rpdj4KICAgICAgICAgICAgPGRpdj7op5LoibLmj4/ov7A6ICR7aW50cm99PC9kaXY+CiAgICAgICAgICBgLAogICAgICAgIHR5cGU6ICdzdWNjZXNzJwogICAgICB9KQogICAgfSwKCiAgICBnZW5lcmF0ZVRyZWVSb3V0ZUlkcyhyb3V0ZXMsIHJvdXRlSWRzKSB7CiAgICAgIGNvbnN0IHJlcyA9IFtdCgogICAgICBmb3IgKGNvbnN0IHJvdXRlIG9mIHJvdXRlcykgewogICAgICAgIHJvdXRlSWRzLnB1c2gocm91dGUuaWQpCgogICAgICAgIGlmIChyb3V0ZS5jaGlsZHJlbikgewogICAgICAgICAgY29uc3QgdG1wUmVzID0gdGhpcy5nZW5lcmF0ZVRyZWVSb3V0ZUlkcyhyb3V0ZS5jaGlsZHJlbiwgcm91dGVJZHMpCiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiByb3V0ZUlkcwogICAgfSwKICAgIGdlbmVyYXRlVHJlZShyb3V0ZXMsIHJvdXRlSWQgPSAtMSwgY2hlY2tlZEtleXMpIHsKICAgICAgY29uc3QgcmVzID0gW10KCiAgICAgIGZvciAoY29uc3Qgcm91dGUgb2Ygcm91dGVzKSB7CiAgICAgICAgY29uc3Qgcm91dGVJZCA9IHJvdXRlLmlkLy9wYXRoLnJlc29sdmUoYmFzZVBhdGgsIHJvdXRlLnBhdGgpCgogICAgICAgIC8vIHJlY3Vyc2l2ZSBjaGlsZCByb3V0ZXMKICAgICAgICBpZiAocm91dGUuY2hpbGRyZW4pIHsKICAgICAgICAgIHJvdXRlLmNoaWxkcmVuID0gdGhpcy5nZW5lcmF0ZVRyZWUocm91dGUuY2hpbGRyZW4sIHJvdXRlSWQsIGNoZWNrZWRLZXlzKQogICAgICAgIH0KCiAgICAgICAgaWYgKGNoZWNrZWRLZXlzLmluY2x1ZGVzKHJvdXRlSWQpIHx8IChyb3V0ZS5jaGlsZHJlbiAmJiByb3V0ZS5jaGlsZHJlbi5sZW5ndGggPj0gMSkpIHsKICAgICAgICAgIHJlcy5wdXNoKHJvdXRlKQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmVzCiAgICB9LAoKICAgIC8vIHJlZmVyZW5jZTogc3JjL3ZpZXcvbGF5b3V0L2NvbXBvbmVudHMvU2lkZWJhci9TaWRlYmFySXRlbS52dWUKICAgIG9ubHlPbmVTaG93aW5nQ2hpbGQoY2hpbGRyZW4gPSBbXSwgcGFyZW50KSB7CiAgICAgIGxldCBvbmx5T25lQ2hpbGQgPSBudWxsCiAgICAgIGNvbnN0IHNob3dpbmdDaGlsZHJlbiA9IGNoaWxkcmVuLmZpbHRlcihpdGVtID0+ICFpdGVtLmhpZGRlbikKCiAgICAgIC8vIFdoZW4gdGhlcmUgaXMgb25seSBvbmUgY2hpbGQgcm91dGUsIHRoZSBjaGlsZCByb3V0ZSBpcyBkaXNwbGF5ZWQgYnkgZGVmYXVsdAogICAgICBpZiAoc2hvd2luZ0NoaWxkcmVuLmxlbmd0aCA9PT0gMSkgewogICAgICAgIG9ubHlPbmVDaGlsZCA9IHNob3dpbmdDaGlsZHJlblswXQogICAgICAgIG9ubHlPbmVDaGlsZC5wYXRoID0gcGF0aC5yZXNvbHZlKHBhcmVudC5wYXRoLCBvbmx5T25lQ2hpbGQucGF0aCkKICAgICAgICByZXR1cm4gb25seU9uZUNoaWxkCiAgICAgIH0KCiAgICAgIC8vIFNob3cgcGFyZW50IGlmIHRoZXJlIGFyZSBubyBjaGlsZCByb3V0ZSB0byBkaXNwbGF5CiAgICAgIGlmIChzaG93aW5nQ2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7CiAgICAgICAgb25seU9uZUNoaWxkID0geyAuLi4gcGFyZW50LCBwYXRoOiAnJywgbm9TaG93aW5nQ2hpbGRyZW46IHRydWUgfQogICAgICAgIHJldHVybiBvbmx5T25lQ2hpbGQKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlCiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["role.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8DA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"role.vue","sourceRoot":"src/views/permission","sourcesContent":["<template>\n  <div class=\"app-container\">\n    <el-button v-if=\"checkPermission(['admin'])\" type=\"primary\" @click=\"handleAddRole\">新建角色</el-button>\n\n    <el-table :data=\"rolesList\" style=\"width: 100%;margin-top:30px;\" border>\n      <el-table-column align=\"center\" label=\"ID\" width=\"220\">\n        <template slot-scope=\"scope\">\n          {{ scope.row.id }}\n        </template>\n      </el-table-column>\n      <el-table-column align=\"center\" label=\"角色名称\" width=\"220\">\n        <template slot-scope=\"scope\">\n          {{ scope.row.name }}\n        </template>\n      </el-table-column>\n      <el-table-column align=\"header-center\" label=\"角色描述\">\n        <template slot-scope=\"scope\">\n          {{ scope.row.intro }}\n        </template>\n      </el-table-column>\n      <el-table-column v-if=\"checkPermission(['admin'])\" align=\"center\" label=\"操作\">\n        <template slot-scope=\"scope\">\n          <el-button type=\"primary\" size=\"small\" @click=\"handleEdit(scope)\">编辑</el-button>\n          <el-button type=\"danger\" size=\"small\" @click=\"handleDelete(scope)\">删除</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n\n    <el-dialog :visible.sync=\"dialogVisible\" :title=\"dialogType==='edit'?'编辑角色':'新建角色'\">\n      <el-form :model=\"role\" label-width=\"80px\" label-position=\"left\">\n        <el-form-item label=\"角色名称\">\n          <el-input v-model=\"role.name\" placeholder=\"角色名称\" />\n        </el-form-item>\n        <el-form-item label=\"角色描述\">\n          <el-input\n            v-model=\"role.intro\"\n            :autosize=\"{ minRows: 2, maxRows: 4}\"\n            type=\"textarea\"\n            placeholder=\"角色描述\"\n          />\n        </el-form-item>\n        <el-form-item label=\"权限菜单\">\n          <el-tree\n            ref=\"tree\"\n            :check-strictly=\"checkStrictly\"\n            :data=\"routesData\"\n            :props=\"defaultProps\"\n            show-checkbox\n            node-key=\"id\"\n            class=\"permission-tree\"\n          />\n        </el-form-item>\n      </el-form>\n      <div style=\"text-align:right;\">\n        <el-button type=\"danger\" @click=\"dialogVisible=false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"confirmRole\">提交</el-button>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport path from 'path'\nimport { deepClone } from '@/utils'\nimport { getToken, setToken, removeToken } from '@/utils/auth'\nimport checkPermission from '@/utils/permission' // 权限判断函数\n\nconst defaultRole = {\n  id: 0,\n  name: '',\n  intro: '',\n  routes: []\n}\n\nexport default {\n  data() {\n    return {\n      role: Object.assign({}, defaultRole),\n      routes: [],\n      rolesList: [],\n      dialogVisible: false,\n      dialogType: 'new',\n      checkStrictly: false,\n      defaultProps: {\n        children: 'children',\n        label: 'title',\n        title: 'title',\n        id: 0\n      }\n    }\n  },\n  computed: {\n    routesData() {\n      return this.routes\n    }\n  },\n  created() {\n    // Mock: get all routes and roles list from server\n    this.getRoutes()\n    this.getRoles()\n  },\n  methods: {\n    checkPermission,\n    async getRoutes() {\n      const res = await this.api.role().getRoutes()\n      this.serviceRoutes = res.data\n\n      this.routes = this.generateRoutes(res.data)\n    },\n    async getRoles() {\n      const res = await this.api.role().getRoles({token:getToken()})\n      this.rolesList = res.data\n    },\n\n    // Reshape the routes structure so that it looks the same as the sidebar\n    generateRoutes(routes, basePath = '/') {\n      const res = []\n\n      for (let route of routes) {\n        // skip some route\n        if (route.hidden) { continue }\n\n        const onlyOneShowingChild = this.onlyOneShowingChild(route.children, route)\n\n        if (route.children && onlyOneShowingChild && !route.alwaysShow) {\n          route = onlyOneShowingChild\n        }\n\n        const data = {\n          path: path.resolve(basePath, route.path),\n          title: route.title,\n          label: route.title,\n          id: route.id\n        }\n\n        // recursive child routes\n        if (route.children) {\n          data.children = this.generateRoutes(route.children, data.path)\n        }\n        res.push(data)\n      }\n      return res\n    },\n    generateArr(routes) {\n      let data = []\n      routes.forEach(route => {\n        data.push(route)\n        if (route.children) {\n          const temp = this.generateArr(route.children)\n          if (temp.length > 0) {\n            data = [...data, ...temp]\n          }\n        }\n      })\n      return data\n    },\n    handleAddRole() {\n      this.role = Object.assign({}, defaultRole)\n      if (this.$refs.tree) {\n        this.$refs.tree.setCheckedNodes([])\n      }\n      this.dialogType = 'new'\n      this.dialogVisible = true\n    },\n    handleEdit(scope) {\n      this.dialogType = 'edit'\n      this.dialogVisible = true\n      this.checkStrictly = true\n      this.role = deepClone(scope.row)\n      this.$nextTick(() => {\n        const routes = this.generateRoutes(this.role.routes)\n        this.$refs.tree.setCheckedNodes(this.generateArr(routes))\n        // set checked state of a node not affects its father and child nodes\n        this.checkStrictly = false\n      })\n    },\n    handleDelete({ $index, row }) {\n      if (row.id == 1) {\n        this.$message({\n          type: 'warning',\n          message: '超级管理员无法删除!'\n        })\n        return\n      }\n      this.$confirm('确定删除此角色?', '提示', {\n        confirmButtonText: '确认',\n        cancelButtonText: '取消',\n        type: 'warning'\n      })\n        .then(async() => {\n          await this.api.role().deleteRole({'id':row.id})\n          this.rolesList.splice($index, 1)\n          this.$message({\n            type: 'success',\n            message: '删除成功!'\n          })\n        })\n        .catch(err => { console.error(err) })\n    },\n    async confirmRole() {\n      const isEdit = this.dialogType === 'edit'\n\n      const checkedKeys = this.$refs.tree.getCheckedKeys()\n\n      let routes = this.generateTree(deepClone(this.serviceRoutes), -1, checkedKeys)\n\n      let routeIds = []\n      this.generateTreeRouteIds(routes, routeIds);\n      this.role.routeIds = routeIds.join(',')\n\n      if (isEdit) {\n        const { data } = await this.api.role().updateRole(this.role)\n        this.role.routes = data.routes\n        for (let index = 0; index < this.rolesList.length; index++) {\n          if (this.rolesList[index].id === this.role.id) {\n            this.rolesList.splice(index, 1, Object.assign({}, this.role))\n            break\n          }\n        }\n      } else {\n        const { data } = await this.api.role().addRole(this.role)\n        this.role.id = data.id\n        this.role.routes = data.routes\n        this.rolesList.push(this.role)\n      }\n\n      const { id, name, intro } = this.role\n      this.dialogVisible = false\n      this.$notify({\n        title: 'Success',\n        dangerouslyUseHTMLString: true,\n        message: `\n            <div>角色ID: ${id}</div>\n            <div>角色名称: ${name}</div>\n            <div>角色描述: ${intro}</div>\n          `,\n        type: 'success'\n      })\n    },\n\n    generateTreeRouteIds(routes, routeIds) {\n      const res = []\n\n      for (const route of routes) {\n        routeIds.push(route.id)\n\n        if (route.children) {\n          const tmpRes = this.generateTreeRouteIds(route.children, routeIds)\n        }\n      }\n      return routeIds\n    },\n    generateTree(routes, routeId = -1, checkedKeys) {\n      const res = []\n\n      for (const route of routes) {\n        const routeId = route.id//path.resolve(basePath, route.path)\n\n        // recursive child routes\n        if (route.children) {\n          route.children = this.generateTree(route.children, routeId, checkedKeys)\n        }\n\n        if (checkedKeys.includes(routeId) || (route.children && route.children.length >= 1)) {\n          res.push(route)\n        }\n      }\n      return res\n    },\n\n    // reference: src/view/layout/components/Sidebar/SidebarItem.vue\n    onlyOneShowingChild(children = [], parent) {\n      let onlyOneChild = null\n      const showingChildren = children.filter(item => !item.hidden)\n\n      // When there is only one child route, the child route is displayed by default\n      if (showingChildren.length === 1) {\n        onlyOneChild = showingChildren[0]\n        onlyOneChild.path = path.resolve(parent.path, onlyOneChild.path)\n        return onlyOneChild\n      }\n\n      // Show parent if there are no child route to display\n      if (showingChildren.length === 0) {\n        onlyOneChild = { ... parent, path: '', noShowingChildren: true }\n        return onlyOneChild\n      }\n\n      return false\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.app-container {\n  .roles-table {\n    margin-top: 30px;\n  }\n  .permission-tree {\n    margin-bottom: 30px;\n  }\n}\n</style>\n"]}]}