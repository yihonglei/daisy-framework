{"remainingRequest":"/Users/hq_ly/mhjy/mhjy_manager/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/hq_ly/mhjy/mhjy_manager/src/views/permission/page.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/hq_ly/mhjy/mhjy_manager/src/views/permission/page.vue","mtime":1659801785660},{"path":"/Users/hq_ly/mhjy/mhjy_manager/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hq_ly/mhjy/mhjy_manager/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/hq_ly/mhjy/mhjy_manager/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hq_ly/mhjy/mhjy_manager/node_modules/vue-loader/lib/index.js","mtime":1655715099000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnCmltcG9ydCB7IGRlZXBDbG9uZSB9IGZyb20gJ0AvdXRpbHMnCmltcG9ydCB7IGdldFJvdXRlcywgZ2V0Um9sZXMsIGFkZFJvbGUsIGRlbGV0ZVJvbGUsIHVwZGF0ZVJvbGUgfSBmcm9tICdAL2FwaS9yb2xlJwppbXBvcnQgeyBnZXRUb2tlbiwgc2V0VG9rZW4sIHJlbW92ZVRva2VuIH0gZnJvbSAnQC91dGlscy9hdXRoJwppbXBvcnQgY2hlY2tQZXJtaXNzaW9uIGZyb20gJ0AvdXRpbHMvcGVybWlzc2lvbicgLy8g5p2D6ZmQ5Yik5pat5Ye95pWwCgpjb25zdCBkZWZhdWx0Um9sZSA9IHsKICBpZDogMCwKICBuYW1lOiAnJywKICBpbnRybzogJycsCiAgcm91dGVzOiBbXQp9CgpleHBvcnQgZGVmYXVsdCB7CiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHJvbGU6IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRSb2xlKSwKICAgICAgcm91dGVzOiBbXSwKICAgICAgcm9sZXNMaXN0OiBbXSwKICAgICAgZGlhbG9nVmlzaWJsZTogZmFsc2UsCiAgICAgIGRpYWxvZ1R5cGU6ICduZXcnLAogICAgICBjaGVja1N0cmljdGx5OiBmYWxzZSwKICAgICAgZGVmYXVsdFByb3BzOiB7CiAgICAgICAgY2hpbGRyZW46ICdjaGlsZHJlbicsCiAgICAgICAgbGFiZWw6ICd0aXRsZScsCiAgICAgICAgdGl0bGU6ICd0aXRsZScsCiAgICAgICAgaWQ6IDAKICAgICAgfQogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIHJvdXRlc0RhdGEoKSB7CiAgICAgIHJldHVybiB0aGlzLnJvdXRlcwogICAgfQogIH0sCiAgY3JlYXRlZCgpIHsKICAgIC8vIE1vY2s6IGdldCBhbGwgcm91dGVzIGFuZCByb2xlcyBsaXN0IGZyb20gc2VydmVyCiAgICB0aGlzLmdldFJvdXRlcygpCiAgICB0aGlzLmdldFJvbGVzKCkKICB9LAogIG1ldGhvZHM6IHsKICAgIGNoZWNrUGVybWlzc2lvbiwKICAgIGFzeW5jIGdldFJvdXRlcygpIHsKICAgICAgY29uc3QgcmVzID0gYXdhaXQgZ2V0Um91dGVzKCkKICAgICAgdGhpcy5zZXJ2aWNlUm91dGVzID0gcmVzLmRhdGEKCiAgICAgIHRoaXMucm91dGVzID0gdGhpcy5nZW5lcmF0ZVJvdXRlcyhyZXMuZGF0YSkKICAgIH0sCiAgICBhc3luYyBnZXRSb2xlcygpIHsKICAgICAgY29uc3QgcmVzID0gYXdhaXQgZ2V0Um9sZXMoe3Rva2VuOmdldFRva2VuKCl9KQogICAgICB0aGlzLnJvbGVzTGlzdCA9IHJlcy5kYXRhCiAgICB9LAoKICAgIC8vIFJlc2hhcGUgdGhlIHJvdXRlcyBzdHJ1Y3R1cmUgc28gdGhhdCBpdCBsb29rcyB0aGUgc2FtZSBhcyB0aGUgc2lkZWJhcgogICAgZ2VuZXJhdGVSb3V0ZXMocm91dGVzLCBiYXNlUGF0aCA9ICcvJykgewogICAgICBjb25zdCByZXMgPSBbXQoKICAgICAgZm9yIChsZXQgcm91dGUgb2Ygcm91dGVzKSB7CiAgICAgICAgLy8gc2tpcCBzb21lIHJvdXRlCiAgICAgICAgaWYgKHJvdXRlLmhpZGRlbikgeyBjb250aW51ZSB9CgogICAgICAgIGNvbnN0IG9ubHlPbmVTaG93aW5nQ2hpbGQgPSB0aGlzLm9ubHlPbmVTaG93aW5nQ2hpbGQocm91dGUuY2hpbGRyZW4sIHJvdXRlKQoKICAgICAgICBpZiAocm91dGUuY2hpbGRyZW4gJiYgb25seU9uZVNob3dpbmdDaGlsZCAmJiAhcm91dGUuYWx3YXlzU2hvdykgewogICAgICAgICAgcm91dGUgPSBvbmx5T25lU2hvd2luZ0NoaWxkCiAgICAgICAgfQoKICAgICAgICBjb25zdCBkYXRhID0gewogICAgICAgICAgcGF0aDogcGF0aC5yZXNvbHZlKGJhc2VQYXRoLCByb3V0ZS5wYXRoKSwKICAgICAgICAgIHRpdGxlOiByb3V0ZS50aXRsZSwKICAgICAgICAgIGxhYmVsOiByb3V0ZS50aXRsZSwKICAgICAgICAgIGlkOiByb3V0ZS5pZAogICAgICAgIH0KCiAgICAgICAgLy8gcmVjdXJzaXZlIGNoaWxkIHJvdXRlcwogICAgICAgIGlmIChyb3V0ZS5jaGlsZHJlbikgewogICAgICAgICAgZGF0YS5jaGlsZHJlbiA9IHRoaXMuZ2VuZXJhdGVSb3V0ZXMocm91dGUuY2hpbGRyZW4sIGRhdGEucGF0aCkKICAgICAgICB9CiAgICAgICAgcmVzLnB1c2goZGF0YSkKICAgICAgfQogICAgICByZXR1cm4gcmVzCiAgICB9LAogICAgZ2VuZXJhdGVBcnIocm91dGVzKSB7CiAgICAgIGxldCBkYXRhID0gW10KICAgICAgcm91dGVzLmZvckVhY2gocm91dGUgPT4gewogICAgICAgIGRhdGEucHVzaChyb3V0ZSkKICAgICAgICBpZiAocm91dGUuY2hpbGRyZW4pIHsKICAgICAgICAgIGNvbnN0IHRlbXAgPSB0aGlzLmdlbmVyYXRlQXJyKHJvdXRlLmNoaWxkcmVuKQogICAgICAgICAgaWYgKHRlbXAubGVuZ3RoID4gMCkgewogICAgICAgICAgICBkYXRhID0gWy4uLmRhdGEsIC4uLnRlbXBdCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KQogICAgICByZXR1cm4gZGF0YQogICAgfSwKICAgIGhhbmRsZUFkZFJvbGUoKSB7CiAgICAgIHRoaXMucm9sZSA9IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRSb2xlKQogICAgICBpZiAodGhpcy4kcmVmcy50cmVlKSB7CiAgICAgICAgdGhpcy4kcmVmcy50cmVlLnNldENoZWNrZWROb2RlcyhbXSkKICAgICAgfQogICAgICB0aGlzLmRpYWxvZ1R5cGUgPSAnbmV3JwogICAgICB0aGlzLmRpYWxvZ1Zpc2libGUgPSB0cnVlCiAgICB9LAogICAgaGFuZGxlRWRpdChzY29wZSkgewogICAgICB0aGlzLmRpYWxvZ1R5cGUgPSAnZWRpdCcKICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gdHJ1ZQogICAgICB0aGlzLmNoZWNrU3RyaWN0bHkgPSB0cnVlCiAgICAgIHRoaXMucm9sZSA9IGRlZXBDbG9uZShzY29wZS5yb3cpCiAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICBjb25zdCByb3V0ZXMgPSB0aGlzLmdlbmVyYXRlUm91dGVzKHRoaXMucm9sZS5yb3V0ZXMpCiAgICAgICAgdGhpcy4kcmVmcy50cmVlLnNldENoZWNrZWROb2Rlcyh0aGlzLmdlbmVyYXRlQXJyKHJvdXRlcykpCiAgICAgICAgLy8gc2V0IGNoZWNrZWQgc3RhdGUgb2YgYSBub2RlIG5vdCBhZmZlY3RzIGl0cyBmYXRoZXIgYW5kIGNoaWxkIG5vZGVzCiAgICAgICAgdGhpcy5jaGVja1N0cmljdGx5ID0gZmFsc2UKICAgICAgfSkKICAgIH0sCiAgICBoYW5kbGVEZWxldGUoeyAkaW5kZXgsIHJvdyB9KSB7CiAgICAgIGlmIChyb3cuaWQgPT0gMSkgewogICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgdHlwZTogJ3dhcm5pbmcnLAogICAgICAgICAgbWVzc2FnZTogJ+i2hee6p+euoeeQhuWRmOaXoOazleWIoOmZpCEnCiAgICAgICAgfSkKICAgICAgICByZXR1cm4KICAgICAgfQogICAgICB0aGlzLiRjb25maXJtKCfnoa7lrprliKDpmaTmraTop5LoibI/JywgJ+aPkOekuicsIHsKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ+ehruiupCcsCiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogJ+WPlua2iCcsCiAgICAgICAgdHlwZTogJ3dhcm5pbmcnCiAgICAgIH0pCiAgICAgICAgLnRoZW4oYXN5bmMoKSA9PiB7CiAgICAgICAgICBhd2FpdCBkZWxldGVSb2xlKHsnaWQnOnJvdy5pZH0pCiAgICAgICAgICB0aGlzLnJvbGVzTGlzdC5zcGxpY2UoJGluZGV4LCAxKQogICAgICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJywKICAgICAgICAgICAgbWVzc2FnZTogJ+WIoOmZpOaIkOWKnyEnCiAgICAgICAgICB9KQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKGVyciA9PiB7IGNvbnNvbGUuZXJyb3IoZXJyKSB9KQogICAgfSwKICAgIGFzeW5jIGNvbmZpcm1Sb2xlKCkgewogICAgICBjb25zdCBpc0VkaXQgPSB0aGlzLmRpYWxvZ1R5cGUgPT09ICdlZGl0JwoKICAgICAgY29uc3QgY2hlY2tlZEtleXMgPSB0aGlzLiRyZWZzLnRyZWUuZ2V0Q2hlY2tlZEtleXMoKQoKICAgICAgbGV0IHJvdXRlcyA9IHRoaXMuZ2VuZXJhdGVUcmVlKGRlZXBDbG9uZSh0aGlzLnNlcnZpY2VSb3V0ZXMpLCAtMSwgY2hlY2tlZEtleXMpCgogICAgICBsZXQgcm91dGVJZHMgPSBbXQogICAgICB0aGlzLmdlbmVyYXRlVHJlZVJvdXRlSWRzKHJvdXRlcywgcm91dGVJZHMpOwogICAgICB0aGlzLnJvbGUucm91dGVJZHMgPSByb3V0ZUlkcy5qb2luKCcsJykKCiAgICAgIGlmIChpc0VkaXQpIHsKICAgICAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IHVwZGF0ZVJvbGUodGhpcy5yb2xlKQogICAgICAgIHRoaXMucm9sZS5yb3V0ZXMgPSBkYXRhLnJvdXRlcwogICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLnJvbGVzTGlzdC5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgIGlmICh0aGlzLnJvbGVzTGlzdFtpbmRleF0uaWQgPT09IHRoaXMucm9sZS5pZCkgewogICAgICAgICAgICB0aGlzLnJvbGVzTGlzdC5zcGxpY2UoaW5kZXgsIDEsIE9iamVjdC5hc3NpZ24oe30sIHRoaXMucm9sZSkpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgYWRkUm9sZSh0aGlzLnJvbGUpCiAgICAgICAgdGhpcy5yb2xlLmlkID0gZGF0YS5pZAogICAgICAgIHRoaXMucm9sZS5yb3V0ZXMgPSBkYXRhLnJvdXRlcwogICAgICAgIHRoaXMucm9sZXNMaXN0LnB1c2godGhpcy5yb2xlKQogICAgICB9CgogICAgICBjb25zdCB7IGlkLCBuYW1lLCBpbnRybyB9ID0gdGhpcy5yb2xlCiAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IGZhbHNlCiAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgdGl0bGU6ICdTdWNjZXNzJywKICAgICAgICBkYW5nZXJvdXNseVVzZUhUTUxTdHJpbmc6IHRydWUsCiAgICAgICAgbWVzc2FnZTogYAogICAgICAgICAgICA8ZGl2PuinkuiJsklEOiAke2lkfTwvZGl2PgogICAgICAgICAgICA8ZGl2PuinkuiJsuWQjeensDogJHtuYW1lfTwvZGl2PgogICAgICAgICAgICA8ZGl2PuinkuiJsuaPj+i/sDogJHtpbnRyb308L2Rpdj4KICAgICAgICAgIGAsCiAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnCiAgICAgIH0pCiAgICB9LAoKICAgIGdlbmVyYXRlVHJlZVJvdXRlSWRzKHJvdXRlcywgcm91dGVJZHMpIHsKICAgICAgY29uc3QgcmVzID0gW10KCiAgICAgIGZvciAoY29uc3Qgcm91dGUgb2Ygcm91dGVzKSB7CiAgICAgICAgcm91dGVJZHMucHVzaChyb3V0ZS5pZCkKCiAgICAgICAgaWYgKHJvdXRlLmNoaWxkcmVuKSB7CiAgICAgICAgICBjb25zdCB0bXBSZXMgPSB0aGlzLmdlbmVyYXRlVHJlZVJvdXRlSWRzKHJvdXRlLmNoaWxkcmVuLCByb3V0ZUlkcykKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHJvdXRlSWRzCiAgICB9LAogICAgZ2VuZXJhdGVUcmVlKHJvdXRlcywgcm91dGVJZCA9IC0xLCBjaGVja2VkS2V5cykgewogICAgICBjb25zdCByZXMgPSBbXQoKICAgICAgZm9yIChjb25zdCByb3V0ZSBvZiByb3V0ZXMpIHsKICAgICAgICBjb25zdCByb3V0ZUlkID0gcm91dGUuaWQvL3BhdGgucmVzb2x2ZShiYXNlUGF0aCwgcm91dGUucGF0aCkKCiAgICAgICAgLy8gcmVjdXJzaXZlIGNoaWxkIHJvdXRlcwogICAgICAgIGlmIChyb3V0ZS5jaGlsZHJlbikgewogICAgICAgICAgcm91dGUuY2hpbGRyZW4gPSB0aGlzLmdlbmVyYXRlVHJlZShyb3V0ZS5jaGlsZHJlbiwgcm91dGVJZCwgY2hlY2tlZEtleXMpCiAgICAgICAgfQoKICAgICAgICBpZiAoY2hlY2tlZEtleXMuaW5jbHVkZXMocm91dGVJZCkgfHwgKHJvdXRlLmNoaWxkcmVuICYmIHJvdXRlLmNoaWxkcmVuLmxlbmd0aCA+PSAxKSkgewogICAgICAgICAgcmVzLnB1c2gocm91dGUpCiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiByZXMKICAgIH0sCgogICAgLy8gcmVmZXJlbmNlOiBzcmMvdmlldy9sYXlvdXQvY29tcG9uZW50cy9TaWRlYmFyL1NpZGViYXJJdGVtLnZ1ZQogICAgb25seU9uZVNob3dpbmdDaGlsZChjaGlsZHJlbiA9IFtdLCBwYXJlbnQpIHsKICAgICAgbGV0IG9ubHlPbmVDaGlsZCA9IG51bGwKICAgICAgY29uc3Qgc2hvd2luZ0NoaWxkcmVuID0gY2hpbGRyZW4uZmlsdGVyKGl0ZW0gPT4gIWl0ZW0uaGlkZGVuKQoKICAgICAgLy8gV2hlbiB0aGVyZSBpcyBvbmx5IG9uZSBjaGlsZCByb3V0ZSwgdGhlIGNoaWxkIHJvdXRlIGlzIGRpc3BsYXllZCBieSBkZWZhdWx0CiAgICAgIGlmIChzaG93aW5nQ2hpbGRyZW4ubGVuZ3RoID09PSAxKSB7CiAgICAgICAgb25seU9uZUNoaWxkID0gc2hvd2luZ0NoaWxkcmVuWzBdCiAgICAgICAgb25seU9uZUNoaWxkLnBhdGggPSBwYXRoLnJlc29sdmUocGFyZW50LnBhdGgsIG9ubHlPbmVDaGlsZC5wYXRoKQogICAgICAgIHJldHVybiBvbmx5T25lQ2hpbGQKICAgICAgfQoKICAgICAgLy8gU2hvdyBwYXJlbnQgaWYgdGhlcmUgYXJlIG5vIGNoaWxkIHJvdXRlIHRvIGRpc3BsYXkKICAgICAgaWYgKHNob3dpbmdDaGlsZHJlbi5sZW5ndGggPT09IDApIHsKICAgICAgICBvbmx5T25lQ2hpbGQgPSB7IC4uLiBwYXJlbnQsIHBhdGg6ICcnLCBub1Nob3dpbmdDaGlsZHJlbjogdHJ1ZSB9CiAgICAgICAgcmV0dXJuIG9ubHlPbmVDaGlsZAogICAgICB9CgogICAgICByZXR1cm4gZmFsc2UKICAgIH0KICB9Cn0K"},{"version":3,"sources":["page.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8DA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"page.vue","sourceRoot":"src/views/permission","sourcesContent":["<template>\n  <div class=\"app-container\">\n    <el-button v-if=\"checkPermission(['admin'])\" type=\"primary\" @click=\"handleAddRole\">新建角色</el-button>\n\n    <el-table :data=\"rolesList\" style=\"width: 100%;margin-top:30px;\" border>\n      <el-table-column align=\"center\" label=\"ID\" width=\"220\">\n        <template slot-scope=\"scope\">\n          {{ scope.row.id }}\n        </template>\n      </el-table-column>\n      <el-table-column align=\"center\" label=\"角色名称\" width=\"220\">\n        <template slot-scope=\"scope\">\n          {{ scope.row.name }}\n        </template>\n      </el-table-column>\n      <el-table-column align=\"header-center\" label=\"角色描述\">\n        <template slot-scope=\"scope\">\n          {{ scope.row.intro }}\n        </template>\n      </el-table-column>\n      <el-table-column v-if=\"checkPermission(['admin'])\" align=\"center\" label=\"操作\">\n        <template slot-scope=\"scope\">\n          <el-button type=\"primary\" size=\"small\" @click=\"handleEdit(scope)\">编辑</el-button>\n          <el-button type=\"danger\" size=\"small\" @click=\"handleDelete(scope)\">删除</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n\n    <el-dialog :visible.sync=\"dialogVisible\" :title=\"dialogType==='edit'?'编辑角色':'新建角色'\">\n      <el-form :model=\"role\" label-width=\"80px\" label-position=\"left\">\n        <el-form-item label=\"角色名称\">\n          <el-input v-model=\"role.name\" placeholder=\"角色名称\" />\n        </el-form-item>\n        <el-form-item label=\"角色描述\">\n          <el-input\n            v-model=\"role.intro\"\n            :autosize=\"{ minRows: 2, maxRows: 4}\"\n            type=\"textarea\"\n            placeholder=\"角色描述\"\n          />\n        </el-form-item>\n        <el-form-item label=\"权限菜单\">\n          <el-tree\n            ref=\"tree\"\n            :check-strictly=\"checkStrictly\"\n            :data=\"routesData\"\n            :props=\"defaultProps\"\n            show-checkbox\n            node-key=\"id\"\n            class=\"permission-tree\"\n          />\n        </el-form-item>\n      </el-form>\n      <div style=\"text-align:right;\">\n        <el-button type=\"danger\" @click=\"dialogVisible=false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"confirmRole\">提交</el-button>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport path from 'path'\nimport { deepClone } from '@/utils'\nimport { getRoutes, getRoles, addRole, deleteRole, updateRole } from '@/api/role'\nimport { getToken, setToken, removeToken } from '@/utils/auth'\nimport checkPermission from '@/utils/permission' // 权限判断函数\n\nconst defaultRole = {\n  id: 0,\n  name: '',\n  intro: '',\n  routes: []\n}\n\nexport default {\n  data() {\n    return {\n      role: Object.assign({}, defaultRole),\n      routes: [],\n      rolesList: [],\n      dialogVisible: false,\n      dialogType: 'new',\n      checkStrictly: false,\n      defaultProps: {\n        children: 'children',\n        label: 'title',\n        title: 'title',\n        id: 0\n      }\n    }\n  },\n  computed: {\n    routesData() {\n      return this.routes\n    }\n  },\n  created() {\n    // Mock: get all routes and roles list from server\n    this.getRoutes()\n    this.getRoles()\n  },\n  methods: {\n    checkPermission,\n    async getRoutes() {\n      const res = await getRoutes()\n      this.serviceRoutes = res.data\n\n      this.routes = this.generateRoutes(res.data)\n    },\n    async getRoles() {\n      const res = await getRoles({token:getToken()})\n      this.rolesList = res.data\n    },\n\n    // Reshape the routes structure so that it looks the same as the sidebar\n    generateRoutes(routes, basePath = '/') {\n      const res = []\n\n      for (let route of routes) {\n        // skip some route\n        if (route.hidden) { continue }\n\n        const onlyOneShowingChild = this.onlyOneShowingChild(route.children, route)\n\n        if (route.children && onlyOneShowingChild && !route.alwaysShow) {\n          route = onlyOneShowingChild\n        }\n\n        const data = {\n          path: path.resolve(basePath, route.path),\n          title: route.title,\n          label: route.title,\n          id: route.id\n        }\n\n        // recursive child routes\n        if (route.children) {\n          data.children = this.generateRoutes(route.children, data.path)\n        }\n        res.push(data)\n      }\n      return res\n    },\n    generateArr(routes) {\n      let data = []\n      routes.forEach(route => {\n        data.push(route)\n        if (route.children) {\n          const temp = this.generateArr(route.children)\n          if (temp.length > 0) {\n            data = [...data, ...temp]\n          }\n        }\n      })\n      return data\n    },\n    handleAddRole() {\n      this.role = Object.assign({}, defaultRole)\n      if (this.$refs.tree) {\n        this.$refs.tree.setCheckedNodes([])\n      }\n      this.dialogType = 'new'\n      this.dialogVisible = true\n    },\n    handleEdit(scope) {\n      this.dialogType = 'edit'\n      this.dialogVisible = true\n      this.checkStrictly = true\n      this.role = deepClone(scope.row)\n      this.$nextTick(() => {\n        const routes = this.generateRoutes(this.role.routes)\n        this.$refs.tree.setCheckedNodes(this.generateArr(routes))\n        // set checked state of a node not affects its father and child nodes\n        this.checkStrictly = false\n      })\n    },\n    handleDelete({ $index, row }) {\n      if (row.id == 1) {\n        this.$message({\n          type: 'warning',\n          message: '超级管理员无法删除!'\n        })\n        return\n      }\n      this.$confirm('确定删除此角色?', '提示', {\n        confirmButtonText: '确认',\n        cancelButtonText: '取消',\n        type: 'warning'\n      })\n        .then(async() => {\n          await deleteRole({'id':row.id})\n          this.rolesList.splice($index, 1)\n          this.$message({\n            type: 'success',\n            message: '删除成功!'\n          })\n        })\n        .catch(err => { console.error(err) })\n    },\n    async confirmRole() {\n      const isEdit = this.dialogType === 'edit'\n\n      const checkedKeys = this.$refs.tree.getCheckedKeys()\n\n      let routes = this.generateTree(deepClone(this.serviceRoutes), -1, checkedKeys)\n\n      let routeIds = []\n      this.generateTreeRouteIds(routes, routeIds);\n      this.role.routeIds = routeIds.join(',')\n\n      if (isEdit) {\n        const { data } = await updateRole(this.role)\n        this.role.routes = data.routes\n        for (let index = 0; index < this.rolesList.length; index++) {\n          if (this.rolesList[index].id === this.role.id) {\n            this.rolesList.splice(index, 1, Object.assign({}, this.role))\n            break\n          }\n        }\n      } else {\n        const { data } = await addRole(this.role)\n        this.role.id = data.id\n        this.role.routes = data.routes\n        this.rolesList.push(this.role)\n      }\n\n      const { id, name, intro } = this.role\n      this.dialogVisible = false\n      this.$notify({\n        title: 'Success',\n        dangerouslyUseHTMLString: true,\n        message: `\n            <div>角色ID: ${id}</div>\n            <div>角色名称: ${name}</div>\n            <div>角色描述: ${intro}</div>\n          `,\n        type: 'success'\n      })\n    },\n\n    generateTreeRouteIds(routes, routeIds) {\n      const res = []\n\n      for (const route of routes) {\n        routeIds.push(route.id)\n\n        if (route.children) {\n          const tmpRes = this.generateTreeRouteIds(route.children, routeIds)\n        }\n      }\n      return routeIds\n    },\n    generateTree(routes, routeId = -1, checkedKeys) {\n      const res = []\n\n      for (const route of routes) {\n        const routeId = route.id//path.resolve(basePath, route.path)\n\n        // recursive child routes\n        if (route.children) {\n          route.children = this.generateTree(route.children, routeId, checkedKeys)\n        }\n\n        if (checkedKeys.includes(routeId) || (route.children && route.children.length >= 1)) {\n          res.push(route)\n        }\n      }\n      return res\n    },\n\n    // reference: src/view/layout/components/Sidebar/SidebarItem.vue\n    onlyOneShowingChild(children = [], parent) {\n      let onlyOneChild = null\n      const showingChildren = children.filter(item => !item.hidden)\n\n      // When there is only one child route, the child route is displayed by default\n      if (showingChildren.length === 1) {\n        onlyOneChild = showingChildren[0]\n        onlyOneChild.path = path.resolve(parent.path, onlyOneChild.path)\n        return onlyOneChild\n      }\n\n      // Show parent if there are no child route to display\n      if (showingChildren.length === 0) {\n        onlyOneChild = { ... parent, path: '', noShowingChildren: true }\n        return onlyOneChild\n      }\n\n      return false\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.app-container {\n  .roles-table {\n    margin-top: 30px;\n  }\n  .permission-tree {\n    margin-bottom: 30px;\n  }\n}\n</style>\n"]}]}