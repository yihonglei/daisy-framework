{"remainingRequest":"/Users/hq_ly/mhjy/mhjy_manager/node_modules/babel-loader/lib/index.js!/Users/hq_ly/mhjy/mhjy_manager/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/hq_ly/mhjy/mhjy_manager/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/hq_ly/mhjy/mhjy_manager/src/views/permission/role.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/hq_ly/mhjy/mhjy_manager/src/views/permission/role.vue","mtime":1659693419393},{"path":"/Users/hq_ly/mhjy/mhjy_manager/babel.config.js","mtime":1657164828372},{"path":"/Users/hq_ly/mhjy/mhjy_manager/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hq_ly/mhjy/mhjy_manager/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/hq_ly/mhjy/mhjy_manager/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hq_ly/mhjy/mhjy_manager/node_modules/vue-loader/lib/index.js","mtime":1655715099000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL1VzZXJzL2hxX2x5L21oankvbWhqeV9tYW5hZ2VyL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyLmpzIjsKaW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICIvVXNlcnMvaHFfbHkvbWhqeS9taGp5X21hbmFnZXIvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5LmpzIjsKaW1wb3J0IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIGZyb20gIi9Vc2Vycy9ocV9seS9taGp5L21oanlfbWFuYWdlci9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlci5qcyI7CmltcG9ydCBfcmVnZW5lcmF0b3JSdW50aW1lIGZyb20gIi9Vc2Vycy9ocV9seS9taGp5L21oanlfbWFuYWdlci9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vcmVnZW5lcmF0b3JSdW50aW1lLmpzIjsKaW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9Vc2Vycy9ocV9seS9taGp5L21oanlfbWFuYWdlci9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmNsdWRlcy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pbmNsdWRlcy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbHRlci5qcyI7Ci8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnOwppbXBvcnQgeyBkZWVwQ2xvbmUgfSBmcm9tICdAL3V0aWxzJzsKaW1wb3J0IHsgZ2V0Um91dGVzIGFzIF9nZXRSb3V0ZXMsIGdldFJvbGVzIGFzIF9nZXRSb2xlcywgYWRkUm9sZSwgZGVsZXRlUm9sZSwgdXBkYXRlUm9sZSB9IGZyb20gJ0AvYXBpL3JvbGUnOwppbXBvcnQgeyBnZXRUb2tlbiwgc2V0VG9rZW4sIHJlbW92ZVRva2VuIH0gZnJvbSAnQC91dGlscy9hdXRoJzsKaW1wb3J0IGNoZWNrUGVybWlzc2lvbiBmcm9tICdAL3V0aWxzL3Blcm1pc3Npb24nOyAvLyDmnYPpmZDliKTmlq3lh73mlbAKCnZhciBkZWZhdWx0Um9sZSA9IHsKICBpZDogMCwKICBuYW1lOiAnJywKICBpbnRybzogJycsCiAgcm91dGVzOiBbXQp9OwpleHBvcnQgZGVmYXVsdCB7CiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHJvbGU6IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRSb2xlKSwKICAgICAgcm91dGVzOiBbXSwKICAgICAgcm9sZXNMaXN0OiBbXSwKICAgICAgZGlhbG9nVmlzaWJsZTogZmFsc2UsCiAgICAgIGRpYWxvZ1R5cGU6ICduZXcnLAogICAgICBjaGVja1N0cmljdGx5OiBmYWxzZSwKICAgICAgZGVmYXVsdFByb3BzOiB7CiAgICAgICAgY2hpbGRyZW46ICdjaGlsZHJlbicsCiAgICAgICAgbGFiZWw6ICd0aXRsZScsCiAgICAgICAgdGl0bGU6ICd0aXRsZScsCiAgICAgICAgaWQ6IDAKICAgICAgfQogICAgfTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICByb3V0ZXNEYXRhOiBmdW5jdGlvbiByb3V0ZXNEYXRhKCkgewogICAgICByZXR1cm4gdGhpcy5yb3V0ZXM7CiAgICB9CiAgfSwKICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkgewogICAgLy8gTW9jazogZ2V0IGFsbCByb3V0ZXMgYW5kIHJvbGVzIGxpc3QgZnJvbSBzZXJ2ZXIKICAgIHRoaXMuZ2V0Um91dGVzKCk7CiAgICB0aGlzLmdldFJvbGVzKCk7CiAgfSwKICBtZXRob2RzOiB7CiAgICBjaGVja1Blcm1pc3Npb246IGNoZWNrUGVybWlzc2lvbiwKICAgIGdldFJvdXRlczogZnVuY3Rpb24gZ2V0Um91dGVzKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICB2YXIgcmVzOwogICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgcmV0dXJuIF9nZXRSb3V0ZXMoKTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgcmVzID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgIF90aGlzLnNlcnZpY2VSb3V0ZXMgPSByZXMuZGF0YTsKICAgICAgICAgICAgICAgIF90aGlzLnJvdXRlcyA9IF90aGlzLmdlbmVyYXRlUm91dGVzKHJlcy5kYXRhKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSk7CiAgICAgIH0pKSgpOwogICAgfSwKICAgIGdldFJvbGVzOiBmdW5jdGlvbiBnZXRSb2xlcygpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgICB2YXIgcmVzOwogICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gX2dldFJvbGVzKHsKICAgICAgICAgICAgICAgICAgdG9rZW46IGdldFRva2VuKCkKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICByZXMgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgIF90aGlzMi5yb2xlc0xpc3QgPSByZXMuZGF0YTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyKTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgLy8gUmVzaGFwZSB0aGUgcm91dGVzIHN0cnVjdHVyZSBzbyB0aGF0IGl0IGxvb2tzIHRoZSBzYW1lIGFzIHRoZSBzaWRlYmFyCiAgICBnZW5lcmF0ZVJvdXRlczogZnVuY3Rpb24gZ2VuZXJhdGVSb3V0ZXMocm91dGVzKSB7CiAgICAgIHZhciBiYXNlUGF0aCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogJy8nOwogICAgICB2YXIgcmVzID0gW107CgogICAgICB2YXIgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIocm91dGVzKSwKICAgICAgICAgIF9zdGVwOwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvci5zKCk7ICEoX3N0ZXAgPSBfaXRlcmF0b3IubigpKS5kb25lOykgewogICAgICAgICAgdmFyIHJvdXRlID0gX3N0ZXAudmFsdWU7CgogICAgICAgICAgLy8gc2tpcCBzb21lIHJvdXRlCiAgICAgICAgICBpZiAocm91dGUuaGlkZGVuKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBvbmx5T25lU2hvd2luZ0NoaWxkID0gdGhpcy5vbmx5T25lU2hvd2luZ0NoaWxkKHJvdXRlLmNoaWxkcmVuLCByb3V0ZSk7CgogICAgICAgICAgaWYgKHJvdXRlLmNoaWxkcmVuICYmIG9ubHlPbmVTaG93aW5nQ2hpbGQgJiYgIXJvdXRlLmFsd2F5c1Nob3cpIHsKICAgICAgICAgICAgcm91dGUgPSBvbmx5T25lU2hvd2luZ0NoaWxkOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBkYXRhID0gewogICAgICAgICAgICBwYXRoOiBwYXRoLnJlc29sdmUoYmFzZVBhdGgsIHJvdXRlLnBhdGgpLAogICAgICAgICAgICB0aXRsZTogcm91dGUudGl0bGUsCiAgICAgICAgICAgIGxhYmVsOiByb3V0ZS50aXRsZSwKICAgICAgICAgICAgaWQ6IHJvdXRlLmlkCiAgICAgICAgICB9OyAvLyByZWN1cnNpdmUgY2hpbGQgcm91dGVzCgogICAgICAgICAgaWYgKHJvdXRlLmNoaWxkcmVuKSB7CiAgICAgICAgICAgIGRhdGEuY2hpbGRyZW4gPSB0aGlzLmdlbmVyYXRlUm91dGVzKHJvdXRlLmNoaWxkcmVuLCBkYXRhLnBhdGgpOwogICAgICAgICAgfQoKICAgICAgICAgIHJlcy5wdXNoKGRhdGEpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yLmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3IuZigpOwogICAgICB9CgogICAgICByZXR1cm4gcmVzOwogICAgfSwKICAgIGdlbmVyYXRlQXJyOiBmdW5jdGlvbiBnZW5lcmF0ZUFycihyb3V0ZXMpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB2YXIgZGF0YSA9IFtdOwogICAgICByb3V0ZXMuZm9yRWFjaChmdW5jdGlvbiAocm91dGUpIHsKICAgICAgICBkYXRhLnB1c2gocm91dGUpOwoKICAgICAgICBpZiAocm91dGUuY2hpbGRyZW4pIHsKICAgICAgICAgIHZhciB0ZW1wID0gX3RoaXMzLmdlbmVyYXRlQXJyKHJvdXRlLmNoaWxkcmVuKTsKCiAgICAgICAgICBpZiAodGVtcC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGRhdGEgPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KGRhdGEpLCBfdG9Db25zdW1hYmxlQXJyYXkodGVtcCkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiBkYXRhOwogICAgfSwKICAgIGhhbmRsZUFkZFJvbGU6IGZ1bmN0aW9uIGhhbmRsZUFkZFJvbGUoKSB7CiAgICAgIHRoaXMucm9sZSA9IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRSb2xlKTsKCiAgICAgIGlmICh0aGlzLiRyZWZzLnRyZWUpIHsKICAgICAgICB0aGlzLiRyZWZzLnRyZWUuc2V0Q2hlY2tlZE5vZGVzKFtdKTsKICAgICAgfQoKICAgICAgdGhpcy5kaWFsb2dUeXBlID0gJ25ldyc7CiAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IHRydWU7CiAgICB9LAogICAgaGFuZGxlRWRpdDogZnVuY3Rpb24gaGFuZGxlRWRpdChzY29wZSkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIHRoaXMuZGlhbG9nVHlwZSA9ICdlZGl0JzsKICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gdHJ1ZTsKICAgICAgdGhpcy5jaGVja1N0cmljdGx5ID0gdHJ1ZTsKICAgICAgdGhpcy5yb2xlID0gZGVlcENsb25lKHNjb3BlLnJvdyk7CiAgICAgIHRoaXMuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgcm91dGVzID0gX3RoaXM0LmdlbmVyYXRlUm91dGVzKF90aGlzNC5yb2xlLnJvdXRlcyk7CgogICAgICAgIF90aGlzNC4kcmVmcy50cmVlLnNldENoZWNrZWROb2RlcyhfdGhpczQuZ2VuZXJhdGVBcnIocm91dGVzKSk7IC8vIHNldCBjaGVja2VkIHN0YXRlIG9mIGEgbm9kZSBub3QgYWZmZWN0cyBpdHMgZmF0aGVyIGFuZCBjaGlsZCBub2RlcwoKCiAgICAgICAgX3RoaXM0LmNoZWNrU3RyaWN0bHkgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgaGFuZGxlRGVsZXRlOiBmdW5jdGlvbiBoYW5kbGVEZWxldGUoX3JlZikgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIHZhciAkaW5kZXggPSBfcmVmLiRpbmRleCwKICAgICAgICAgIHJvdyA9IF9yZWYucm93OwoKICAgICAgaWYgKHJvdy5pZCA9PSAxKSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgICB0eXBlOiAnd2FybmluZycsCiAgICAgICAgICBtZXNzYWdlOiAn6LaF57qn566h55CG5ZGY5peg5rOV5Yig6ZmkIScKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuJGNvbmZpcm0oJ+ehruWumuWIoOmZpOatpOinkuiJsj8nLCAn5o+Q56S6JywgewogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAn56Gu6K6kJywKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAn5Y+W5raIJywKICAgICAgICB0eXBlOiAnd2FybmluZycKICAgICAgfSkudGhlbiggLyojX19QVVJFX18qL19hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoKSB7CiAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiBkZWxldGVSb2xlKHsKICAgICAgICAgICAgICAgICAgJ2lkJzogcm93LmlkCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgX3RoaXM1LnJvbGVzTGlzdC5zcGxpY2UoJGluZGV4LCAxKTsKCiAgICAgICAgICAgICAgICBfdGhpczUuJG1lc3NhZ2UoewogICAgICAgICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycsCiAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICfliKDpmaTmiJDlip8hJwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMyk7CiAgICAgIH0pKSkuY2F0Y2goZnVuY3Rpb24gKGVycikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgICAgfSk7CiAgICB9LAogICAgY29uZmlybVJvbGU6IGZ1bmN0aW9uIGNvbmZpcm1Sb2xlKCkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KCkgewogICAgICAgIHZhciBpc0VkaXQsIGNoZWNrZWRLZXlzLCByb3V0ZXMsIHJvdXRlSWRzLCBfeWllbGQkdXBkYXRlUm9sZSwgZGF0YSwgaW5kZXgsIF95aWVsZCRhZGRSb2xlLCBfZGF0YSwgX3RoaXM2JHJvbGUsIGlkLCBuYW1lLCBpbnRybzsKCiAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGlzRWRpdCA9IF90aGlzNi5kaWFsb2dUeXBlID09PSAnZWRpdCc7CiAgICAgICAgICAgICAgICBjaGVja2VkS2V5cyA9IF90aGlzNi4kcmVmcy50cmVlLmdldENoZWNrZWRLZXlzKCk7CiAgICAgICAgICAgICAgICByb3V0ZXMgPSBfdGhpczYuZ2VuZXJhdGVUcmVlKGRlZXBDbG9uZShfdGhpczYuc2VydmljZVJvdXRlcyksIC0xLCBjaGVja2VkS2V5cyk7CiAgICAgICAgICAgICAgICByb3V0ZUlkcyA9IFtdOwoKICAgICAgICAgICAgICAgIF90aGlzNi5nZW5lcmF0ZVRyZWVSb3V0ZUlkcyhyb3V0ZXMsIHJvdXRlSWRzKTsKCiAgICAgICAgICAgICAgICBfdGhpczYucm9sZS5yb3V0ZUlkcyA9IHJvdXRlSWRzLmpvaW4oJywnKTsKCiAgICAgICAgICAgICAgICBpZiAoIWlzRWRpdCkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDIyOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDk7CiAgICAgICAgICAgICAgICByZXR1cm4gdXBkYXRlUm9sZShfdGhpczYucm9sZSk7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIF95aWVsZCR1cGRhdGVSb2xlID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICBkYXRhID0gX3lpZWxkJHVwZGF0ZVJvbGUuZGF0YTsKICAgICAgICAgICAgICAgIF90aGlzNi5yb2xlLnJvdXRlcyA9IGRhdGEucm91dGVzOwogICAgICAgICAgICAgICAgaW5kZXggPSAwOwoKICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgaWYgKCEoaW5kZXggPCBfdGhpczYucm9sZXNMaXN0Lmxlbmd0aCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAyMDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCEoX3RoaXM2LnJvbGVzTGlzdFtpbmRleF0uaWQgPT09IF90aGlzNi5yb2xlLmlkKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDE3OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfdGhpczYucm9sZXNMaXN0LnNwbGljZShpbmRleCwgMSwgT2JqZWN0LmFzc2lnbih7fSwgX3RoaXM2LnJvbGUpKTsKCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgiYnJlYWsiLCAyMCk7CgogICAgICAgICAgICAgIGNhc2UgMTc6CiAgICAgICAgICAgICAgICBpbmRleCsrOwogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxMzsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAyOTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDIyOgogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAyNDsKICAgICAgICAgICAgICAgIHJldHVybiBhZGRSb2xlKF90aGlzNi5yb2xlKTsKCiAgICAgICAgICAgICAgY2FzZSAyNDoKICAgICAgICAgICAgICAgIF95aWVsZCRhZGRSb2xlID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICBfZGF0YSA9IF95aWVsZCRhZGRSb2xlLmRhdGE7CiAgICAgICAgICAgICAgICBfdGhpczYucm9sZS5pZCA9IF9kYXRhLmlkOwogICAgICAgICAgICAgICAgX3RoaXM2LnJvbGUucm91dGVzID0gX2RhdGEucm91dGVzOwoKICAgICAgICAgICAgICAgIF90aGlzNi5yb2xlc0xpc3QucHVzaChfdGhpczYucm9sZSk7CgogICAgICAgICAgICAgIGNhc2UgMjk6CiAgICAgICAgICAgICAgICBfdGhpczYkcm9sZSA9IF90aGlzNi5yb2xlLCBpZCA9IF90aGlzNiRyb2xlLmlkLCBuYW1lID0gX3RoaXM2JHJvbGUubmFtZSwgaW50cm8gPSBfdGhpczYkcm9sZS5pbnRybzsKICAgICAgICAgICAgICAgIF90aGlzNi5kaWFsb2dWaXNpYmxlID0gZmFsc2U7CgogICAgICAgICAgICAgICAgX3RoaXM2LiRub3RpZnkoewogICAgICAgICAgICAgICAgICB0aXRsZTogJ1N1Y2Nlc3MnLAogICAgICAgICAgICAgICAgICBkYW5nZXJvdXNseVVzZUhUTUxTdHJpbmc6IHRydWUsCiAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICJcbiAgICAgICAgICAgIDxkaXY+XHU4OUQyXHU4MjcySUQ6ICIuY29uY2F0KGlkLCAiPC9kaXY+XG4gICAgICAgICAgICA8ZGl2Plx1ODlEMlx1ODI3Mlx1NTQwRFx1NzlGMDogIikuY29uY2F0KG5hbWUsICI8L2Rpdj5cbiAgICAgICAgICAgIDxkaXY+XHU4OUQyXHU4MjcyXHU2M0NGXHU4RkYwOiAiKS5jb25jYXQoaW50cm8sICI8L2Rpdj5cbiAgICAgICAgICAiKSwKICAgICAgICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzMjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNCk7CiAgICAgIH0pKSgpOwogICAgfSwKICAgIGdlbmVyYXRlVHJlZVJvdXRlSWRzOiBmdW5jdGlvbiBnZW5lcmF0ZVRyZWVSb3V0ZUlkcyhyb3V0ZXMsIHJvdXRlSWRzKSB7CiAgICAgIHZhciByZXMgPSBbXTsKCiAgICAgIHZhciBfaXRlcmF0b3IyID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIocm91dGVzKSwKICAgICAgICAgIF9zdGVwMjsKCiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IyLnMoKTsgIShfc3RlcDIgPSBfaXRlcmF0b3IyLm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciByb3V0ZSA9IF9zdGVwMi52YWx1ZTsKICAgICAgICAgIHJvdXRlSWRzLnB1c2gocm91dGUuaWQpOwoKICAgICAgICAgIGlmIChyb3V0ZS5jaGlsZHJlbikgewogICAgICAgICAgICB2YXIgdG1wUmVzID0gdGhpcy5nZW5lcmF0ZVRyZWVSb3V0ZUlkcyhyb3V0ZS5jaGlsZHJlbiwgcm91dGVJZHMpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yMi5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yMi5mKCk7CiAgICAgIH0KCiAgICAgIHJldHVybiByb3V0ZUlkczsKICAgIH0sCiAgICBnZW5lcmF0ZVRyZWU6IGZ1bmN0aW9uIGdlbmVyYXRlVHJlZShyb3V0ZXMpIHsKICAgICAgdmFyIHJvdXRlSWQgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IC0xOwogICAgICB2YXIgY2hlY2tlZEtleXMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiA/IGFyZ3VtZW50c1syXSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIHJlcyA9IFtdOwoKICAgICAgdmFyIF9pdGVyYXRvcjMgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihyb3V0ZXMpLAogICAgICAgICAgX3N0ZXAzOwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjMucygpOyAhKF9zdGVwMyA9IF9pdGVyYXRvcjMubigpKS5kb25lOykgewogICAgICAgICAgdmFyIHJvdXRlID0gX3N0ZXAzLnZhbHVlOwogICAgICAgICAgdmFyIF9yb3V0ZUlkID0gcm91dGUuaWQ7IC8vcGF0aC5yZXNvbHZlKGJhc2VQYXRoLCByb3V0ZS5wYXRoKQogICAgICAgICAgLy8gcmVjdXJzaXZlIGNoaWxkIHJvdXRlcwoKICAgICAgICAgIGlmIChyb3V0ZS5jaGlsZHJlbikgewogICAgICAgICAgICByb3V0ZS5jaGlsZHJlbiA9IHRoaXMuZ2VuZXJhdGVUcmVlKHJvdXRlLmNoaWxkcmVuLCBfcm91dGVJZCwgY2hlY2tlZEtleXMpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChjaGVja2VkS2V5cy5pbmNsdWRlcyhfcm91dGVJZCkgfHwgcm91dGUuY2hpbGRyZW4gJiYgcm91dGUuY2hpbGRyZW4ubGVuZ3RoID49IDEpIHsKICAgICAgICAgICAgcmVzLnB1c2gocm91dGUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yMy5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yMy5mKCk7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXM7CiAgICB9LAogICAgLy8gcmVmZXJlbmNlOiBzcmMvdmlldy9sYXlvdXQvY29tcG9uZW50cy9TaWRlYmFyL1NpZGViYXJJdGVtLnZ1ZQogICAgb25seU9uZVNob3dpbmdDaGlsZDogZnVuY3Rpb24gb25seU9uZVNob3dpbmdDaGlsZCgpIHsKICAgICAgdmFyIGNoaWxkcmVuID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBbXTsKICAgICAgdmFyIHBhcmVudCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkOwogICAgICB2YXIgb25seU9uZUNoaWxkID0gbnVsbDsKICAgICAgdmFyIHNob3dpbmdDaGlsZHJlbiA9IGNoaWxkcmVuLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiAhaXRlbS5oaWRkZW47CiAgICAgIH0pOyAvLyBXaGVuIHRoZXJlIGlzIG9ubHkgb25lIGNoaWxkIHJvdXRlLCB0aGUgY2hpbGQgcm91dGUgaXMgZGlzcGxheWVkIGJ5IGRlZmF1bHQKCiAgICAgIGlmIChzaG93aW5nQ2hpbGRyZW4ubGVuZ3RoID09PSAxKSB7CiAgICAgICAgb25seU9uZUNoaWxkID0gc2hvd2luZ0NoaWxkcmVuWzBdOwogICAgICAgIG9ubHlPbmVDaGlsZC5wYXRoID0gcGF0aC5yZXNvbHZlKHBhcmVudC5wYXRoLCBvbmx5T25lQ2hpbGQucGF0aCk7CiAgICAgICAgcmV0dXJuIG9ubHlPbmVDaGlsZDsKICAgICAgfSAvLyBTaG93IHBhcmVudCBpZiB0aGVyZSBhcmUgbm8gY2hpbGQgcm91dGUgdG8gZGlzcGxheQoKCiAgICAgIGlmIChzaG93aW5nQ2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7CiAgICAgICAgb25seU9uZUNoaWxkID0gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBwYXJlbnQpLCB7fSwgewogICAgICAgICAgcGF0aDogJycsCiAgICAgICAgICBub1Nob3dpbmdDaGlsZHJlbjogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBvbmx5T25lQ2hpbGQ7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9Cn07"},{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8DA;AACA;AACA;AACA;AACA,iD,CAAA;;AAEA;EACAA,KADA;EAEAC,QAFA;EAGAC,SAHA;EAIAC;AAJA;AAOA;EACAC,IADA,kBACA;IACA;MACAC,oCADA;MAEAF,UAFA;MAGAG,aAHA;MAIAC,oBAJA;MAKAC,iBALA;MAMAC,oBANA;MAOAC;QACAC,oBADA;QAEAC,cAFA;QAGAC,cAHA;QAIAb;MAJA;IAPA;EAcA,CAhBA;EAiBAc;IACAC,UADA,wBACA;MACA;IACA;EAHA,CAjBA;EAsBAC,OAtBA,qBAsBA;IACA;IACA;IACA;EACA,CA1BA;EA2BAC;IACAC,gCADA;IAEAC,SAFA,uBAEA;MAAA;;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA,OACAA,YADA;;cAAA;gBACAC,GADA;gBAEA;gBAEA;;cAJA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAKA,CAPA;IAQAC,QARA,sBAQA;MAAA;;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA,OACAA;kBAAAC;gBAAA,EADA;;cAAA;gBACAF,GADA;gBAEA;;cAFA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAGA,CAXA;IAaA;IACAG,cAdA,0BAcApB,MAdA,EAcA;MAAA;MACA;;MADA,2CAGAA,MAHA;MAAA;;MAAA;QAGA;UAAA;;UACA;UACA;YAAA;UAAA;;UAEA;;UAEA;YACAqB;UACA;;UAEA;YACAC,wCADA;YAEAZ,kBAFA;YAGAD,kBAHA;YAIAZ;UAJA,EAVA,CAiBA;;UACA;YACAI;UACA;;UACAgB;QACA;MAzBA;QAAA;MAAA;QAAA;MAAA;;MA0BA;IACA,CAzCA;IA0CAM,WA1CA,uBA0CAvB,MA1CA,EA0CA;MAAA;;MACA;MACAA;QACAC;;QACA;UACA;;UACA;YACAA;UACA;QACA;MACA,CARA;MASA;IACA,CAtDA;IAuDAuB,aAvDA,2BAuDA;MACA;;MACA;QACA;MACA;;MACA;MACA;IACA,CA9DA;IA+DAC,UA/DA,sBA+DAC,KA/DA,EA+DA;MAAA;;MACA;MACA;MACA;MACA;MACA;QACA;;QACA,8DAFA,CAGA;;;QACA;MACA,CALA;IAMA,CA1EA;IA2EAC,YA3EA,8BA2EA;MAAA;;MAAA;MAAA;;MACA;QACA;UACAC,eADA;UAEAC;QAFA;QAIA;MACA;;MACA;QACAC,uBADA;QAEAC,sBAFA;QAGAH;MAHA,GAKAI,IALA,0EAKA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA,OACAC;kBAAA;gBAAA,EADA;;cAAA;gBAEA;;gBACA;kBACAL,eADA;kBAEAC;gBAFA;;cAHA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA,CALA,IAaAK,KAbA,CAaA;QAAAC;MAAA,CAbA;IAcA,CAjGA;IAkGAC,WAlGA,yBAkGA;MAAA;;MAAA;QAAA;;QAAA;UAAA;YAAA;cAAA;gBACAC,MADA,GACA,4BADA;gBAGAC,WAHA,GAGA,kCAHA;gBAKAtC,MALA,GAKA,qEALA;gBAOAuC,QAPA,GAOA,EAPA;;gBAQA;;gBACA;;gBATA,KAWAF,MAXA;kBAAA;kBAAA;gBAAA;;gBAAA;gBAAA,OAYAG,uBAZA;;cAAA;gBAAA;gBAYAvC,IAZA,qBAYAA,IAZA;gBAaA;gBACAwC,KAdA,GAcA,CAdA;;cAAA;gBAAA,MAcAA,+BAdA;kBAAA;kBAAA;gBAAA;;gBAAA,MAeA,6CAfA;kBAAA;kBAAA;gBAAA;;gBAgBA;;gBAhBA;;cAAA;gBAcAA,OAdA;gBAAA;gBAAA;;cAAA;gBAAA;gBAAA;;cAAA;gBAAA;gBAAA,OAqBAC,oBArBA;;cAAA;gBAAA;gBAqBAzC,KArBA,kBAqBAA,IArBA;gBAsBA;gBACA;;gBACA;;cAxBA;gBAAA,cA2BA,WA3BA,EA2BAJ,EA3BA,eA2BAA,EA3BA,EA2BAC,IA3BA,eA2BAA,IA3BA,EA2BAC,KA3BA,eA2BAA,KA3BA;gBA4BA;;gBACA;kBACAW,gBADA;kBAEAiC,8BAFA;kBAGAd,sDACAhC,EADA,gEAEAC,IAFA,gEAGAC,KAHA,uBAHA;kBAQA6B;gBARA;;cA7BA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAuCA,CAzIA;IA2IAgB,oBA3IA,gCA2IA5C,MA3IA,EA2IAuC,QA3IA,EA2IA;MACA;;MADA,4CAGAvC,MAHA;MAAA;;MAAA;QAGA;UAAA;UACAuC;;UAEA;YACA;UACA;QACA;MATA;QAAA;MAAA;QAAA;MAAA;;MAUA;IACA,CAtJA;IAuJAM,YAvJA,wBAuJA7C,MAvJA,EAuJA;MAAA;MAAA;MACA;;MADA,4CAGAA,MAHA;MAAA;;MAAA;QAGA;UAAA;UACA,wBADA,CACA;UAEA;;UACA;YACAqB;UACA;;UAEA;YACAJ;UACA;QACA;MAdA;QAAA;MAAA;QAAA;MAAA;;MAeA;IACA,CAvKA;IAyKA;IACA6B,mBA1KA,iCA0KA;MAAA;MAAA;MACA;MACA;QAAA;MAAA,GAFA,CAIA;;MACA;QACAC;QACAA;QACA;MACA,CATA,CAWA;;;MACA;QACAA;UAAAzB;UAAA0B;QAAA;QACA;MACA;;MAEA;IACA;EA5LA;AA3BA","names":["id","name","intro","routes","data","role","rolesList","dialogVisible","dialogType","checkStrictly","defaultProps","children","label","title","computed","routesData","created","methods","checkPermission","getRoutes","res","getRoles","token","generateRoutes","route","path","generateArr","handleAddRole","handleEdit","scope","handleDelete","type","message","confirmButtonText","cancelButtonText","then","deleteRole","catch","console","confirmRole","isEdit","checkedKeys","routeIds","updateRole","index","addRole","dangerouslyUseHTMLString","generateTreeRouteIds","generateTree","onlyOneShowingChild","onlyOneChild","noShowingChildren"],"sourceRoot":"src/views/permission","sources":["role.vue"],"sourcesContent":["<template>\n  <div class=\"app-container\">\n    <el-button v-if=\"checkPermission(['admin'])\" type=\"primary\" @click=\"handleAddRole\">新建角色</el-button>\n\n    <el-table :data=\"rolesList\" style=\"width: 100%;margin-top:30px;\" border>\n      <el-table-column align=\"center\" label=\"ID\" width=\"220\">\n        <template slot-scope=\"scope\">\n          {{ scope.row.id }}\n        </template>\n      </el-table-column>\n      <el-table-column align=\"center\" label=\"角色名称\" width=\"220\">\n        <template slot-scope=\"scope\">\n          {{ scope.row.name }}\n        </template>\n      </el-table-column>\n      <el-table-column align=\"header-center\" label=\"角色描述\">\n        <template slot-scope=\"scope\">\n          {{ scope.row.intro }}\n        </template>\n      </el-table-column>\n      <el-table-column v-if=\"checkPermission(['admin'])\" align=\"center\" label=\"操作\">\n        <template slot-scope=\"scope\">\n          <el-button type=\"primary\" size=\"small\" @click=\"handleEdit(scope)\">编辑</el-button>\n          <el-button type=\"danger\" size=\"small\" @click=\"handleDelete(scope)\">删除</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n\n    <el-dialog :visible.sync=\"dialogVisible\" :title=\"dialogType==='edit'?'编辑角色':'新建角色'\">\n      <el-form :model=\"role\" label-width=\"80px\" label-position=\"left\">\n        <el-form-item label=\"角色名称\">\n          <el-input v-model=\"role.name\" placeholder=\"角色名称\" />\n        </el-form-item>\n        <el-form-item label=\"角色描述\">\n          <el-input\n            v-model=\"role.intro\"\n            :autosize=\"{ minRows: 2, maxRows: 4}\"\n            type=\"textarea\"\n            placeholder=\"角色描述\"\n          />\n        </el-form-item>\n        <el-form-item label=\"权限菜单\">\n          <el-tree\n            ref=\"tree\"\n            :check-strictly=\"checkStrictly\"\n            :data=\"routesData\"\n            :props=\"defaultProps\"\n            show-checkbox\n            node-key=\"id\"\n            class=\"permission-tree\"\n          />\n        </el-form-item>\n      </el-form>\n      <div style=\"text-align:right;\">\n        <el-button type=\"danger\" @click=\"dialogVisible=false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"confirmRole\">提交</el-button>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport path from 'path'\nimport { deepClone } from '@/utils'\nimport { getRoutes, getRoles, addRole, deleteRole, updateRole } from '@/api/role'\nimport { getToken, setToken, removeToken } from '@/utils/auth'\nimport checkPermission from '@/utils/permission' // 权限判断函数\n\nconst defaultRole = {\n  id: 0,\n  name: '',\n  intro: '',\n  routes: []\n}\n\nexport default {\n  data() {\n    return {\n      role: Object.assign({}, defaultRole),\n      routes: [],\n      rolesList: [],\n      dialogVisible: false,\n      dialogType: 'new',\n      checkStrictly: false,\n      defaultProps: {\n        children: 'children',\n        label: 'title',\n        title: 'title',\n        id: 0\n      }\n    }\n  },\n  computed: {\n    routesData() {\n      return this.routes\n    }\n  },\n  created() {\n    // Mock: get all routes and roles list from server\n    this.getRoutes()\n    this.getRoles()\n  },\n  methods: {\n    checkPermission,\n    async getRoutes() {\n      const res = await getRoutes()\n      this.serviceRoutes = res.data\n\n      this.routes = this.generateRoutes(res.data)\n    },\n    async getRoles() {\n      const res = await getRoles({token:getToken()})\n      this.rolesList = res.data\n    },\n\n    // Reshape the routes structure so that it looks the same as the sidebar\n    generateRoutes(routes, basePath = '/') {\n      const res = []\n\n      for (let route of routes) {\n        // skip some route\n        if (route.hidden) { continue }\n\n        const onlyOneShowingChild = this.onlyOneShowingChild(route.children, route)\n\n        if (route.children && onlyOneShowingChild && !route.alwaysShow) {\n          route = onlyOneShowingChild\n        }\n\n        const data = {\n          path: path.resolve(basePath, route.path),\n          title: route.title,\n          label: route.title,\n          id: route.id\n        }\n\n        // recursive child routes\n        if (route.children) {\n          data.children = this.generateRoutes(route.children, data.path)\n        }\n        res.push(data)\n      }\n      return res\n    },\n    generateArr(routes) {\n      let data = []\n      routes.forEach(route => {\n        data.push(route)\n        if (route.children) {\n          const temp = this.generateArr(route.children)\n          if (temp.length > 0) {\n            data = [...data, ...temp]\n          }\n        }\n      })\n      return data\n    },\n    handleAddRole() {\n      this.role = Object.assign({}, defaultRole)\n      if (this.$refs.tree) {\n        this.$refs.tree.setCheckedNodes([])\n      }\n      this.dialogType = 'new'\n      this.dialogVisible = true\n    },\n    handleEdit(scope) {\n      this.dialogType = 'edit'\n      this.dialogVisible = true\n      this.checkStrictly = true\n      this.role = deepClone(scope.row)\n      this.$nextTick(() => {\n        const routes = this.generateRoutes(this.role.routes)\n        this.$refs.tree.setCheckedNodes(this.generateArr(routes))\n        // set checked state of a node not affects its father and child nodes\n        this.checkStrictly = false\n      })\n    },\n    handleDelete({ $index, row }) {\n      if (row.id == 1) {\n        this.$message({\n          type: 'warning',\n          message: '超级管理员无法删除!'\n        })\n        return\n      }\n      this.$confirm('确定删除此角色?', '提示', {\n        confirmButtonText: '确认',\n        cancelButtonText: '取消',\n        type: 'warning'\n      })\n        .then(async() => {\n          await deleteRole({'id':row.id})\n          this.rolesList.splice($index, 1)\n          this.$message({\n            type: 'success',\n            message: '删除成功!'\n          })\n        })\n        .catch(err => { console.error(err) })\n    },\n    async confirmRole() {\n      const isEdit = this.dialogType === 'edit'\n\n      const checkedKeys = this.$refs.tree.getCheckedKeys()\n\n      let routes = this.generateTree(deepClone(this.serviceRoutes), -1, checkedKeys)\n\n      let routeIds = []\n      this.generateTreeRouteIds(routes, routeIds);\n      this.role.routeIds = routeIds.join(',')\n\n      if (isEdit) {\n        const { data } = await updateRole(this.role)\n        this.role.routes = data.routes\n        for (let index = 0; index < this.rolesList.length; index++) {\n          if (this.rolesList[index].id === this.role.id) {\n            this.rolesList.splice(index, 1, Object.assign({}, this.role))\n            break\n          }\n        }\n      } else {\n        const { data } = await addRole(this.role)\n        this.role.id = data.id\n        this.role.routes = data.routes\n        this.rolesList.push(this.role)\n      }\n\n      const { id, name, intro } = this.role\n      this.dialogVisible = false\n      this.$notify({\n        title: 'Success',\n        dangerouslyUseHTMLString: true,\n        message: `\n            <div>角色ID: ${id}</div>\n            <div>角色名称: ${name}</div>\n            <div>角色描述: ${intro}</div>\n          `,\n        type: 'success'\n      })\n    },\n\n    generateTreeRouteIds(routes, routeIds) {\n      const res = []\n\n      for (const route of routes) {\n        routeIds.push(route.id)\n\n        if (route.children) {\n          const tmpRes = this.generateTreeRouteIds(route.children, routeIds)\n        }\n      }\n      return routeIds\n    },\n    generateTree(routes, routeId = -1, checkedKeys) {\n      const res = []\n\n      for (const route of routes) {\n        const routeId = route.id//path.resolve(basePath, route.path)\n\n        // recursive child routes\n        if (route.children) {\n          route.children = this.generateTree(route.children, routeId, checkedKeys)\n        }\n\n        if (checkedKeys.includes(routeId) || (route.children && route.children.length >= 1)) {\n          res.push(route)\n        }\n      }\n      return res\n    },\n\n    // reference: src/view/layout/components/Sidebar/SidebarItem.vue\n    onlyOneShowingChild(children = [], parent) {\n      let onlyOneChild = null\n      const showingChildren = children.filter(item => !item.hidden)\n\n      // When there is only one child route, the child route is displayed by default\n      if (showingChildren.length === 1) {\n        onlyOneChild = showingChildren[0]\n        onlyOneChild.path = path.resolve(parent.path, onlyOneChild.path)\n        return onlyOneChild\n      }\n\n      // Show parent if there are no child route to display\n      if (showingChildren.length === 0) {\n        onlyOneChild = { ... parent, path: '', noShowingChildren: true }\n        return onlyOneChild\n      }\n\n      return false\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.app-container {\n  .roles-table {\n    margin-top: 30px;\n  }\n  .permission-tree {\n    margin-bottom: 30px;\n  }\n}\n</style>\n"]}]}