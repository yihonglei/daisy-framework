# 一 概述
价格说明页的数据几乎不会变，为了减小数据压力，提高查询性能，数据缓存在 Redis 中。

# 二 缓存一致性问题？
当后台修改数据时，如何保证修改后数据库与缓存中的数据一致性？
1、如果删除了缓存 Redis，还没有来得及写库 MySQL，另一个线程就来读取，发现缓存为空，则去数据库中读取数据
写入缓存，此时缓存中为脏数据。
2、如果先写了库，在删除缓存前，写库的线程宕机了，没有删除掉缓存，则也会出现数据不一致情况。
因为写和读是并发的，没法保证顺序，就会出现缓存和数据库的数据不一致的问题。
如来解决？这里给出两个解决方案，先易后难，结合业务和技术代价选择使用。
# 三 缓存和数据库一致性解决方案
## 方案1：采用延时双删策略
在写库前后都进行redis.del(key)操作，并且设定合理的超时时间。
public void write(String key,Object data){
    redis.delKey(key);
    db.updateData(data);
    Thread.sleep(500);
    redis.delKey(key);
}
步骤：
1）先删除缓存；
2）更新数据库；
3）延时 500 毫秒，主要根据业务主从情况处理；
4）最后再删除一次缓存；
5）如果失败了，事务回滚；
## 方案2：异步更新缓存
canal + rocketmq 增量订阅数据库 binlog，通过消费消息异步更新缓存；

注意：根据自己的业务设置缓存超时时间，因为这样，即使任何一步出问题了，缓存与数据库只是在过期时间内
是不一致的，能够保证最终的一致性；

